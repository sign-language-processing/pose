<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pose_format.utils.holistic &mdash; Pose-Format Toolkit v1.0.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/my.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/assets/jsonview.bundle.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sphinx-needs/libs/html/datatables.min.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sphinx-needs/common.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sphinx-needs/layouts.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sphinx-needs/modern.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sphinx-needs/styles.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/assets/jsonview.bundle.js"></script>
        <script src="../../../_static/assets/jsonview_loader.js"></script>
        <script src="../../../_static/sphinx-needs/libs/html/datatables.min.js"></script>
        <script src="../../../_static/sphinx-needs/libs/html/datatables_loader.js"></script>
        <script src="../../../_static/sphinx-needs/libs/html/sphinx_needs_collapse.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Pose-Format Toolkit
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Pose Format Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python Code Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pose_format.html">pose_format package</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional Material</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../js_docs.html">JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../specs_v01.html">specs/v0.1.md</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Pose-Format Toolkit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pose_format.utils.holistic</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pose_format.utils.holistic</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">from</span> <span class="nn">.openpose</span> <span class="kn">import</span> <span class="n">hand_colors</span>
<span class="kn">from</span> <span class="nn">..numpy.pose_body</span> <span class="kn">import</span> <span class="n">NumPyPoseBody</span>
<span class="kn">from</span> <span class="nn">..pose</span> <span class="kn">import</span> <span class="n">Pose</span>
<span class="kn">from</span> <span class="nn">..pose_header</span> <span class="kn">import</span> <span class="n">PoseHeader</span><span class="p">,</span> <span class="n">PoseHeaderComponent</span><span class="p">,</span> <span class="n">PoseHeaderDimensions</span>
<span class="kn">from</span> <span class="nn">.openpose</span> <span class="kn">import</span> <span class="n">load_frames_directory_dict</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">mediapipe</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Please install mediapipe with: pip install mediapipe&quot;</span><span class="p">)</span>

<span class="n">mp_holistic</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">solutions</span><span class="o">.</span><span class="n">holistic</span>

<span class="n">FACEMESH_CONTOURS_POINTS</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span>
                            <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p_tup</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">mp_holistic</span><span class="o">.</span><span class="n">FACEMESH_CONTOURS</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p_tup</span><span class="p">]))]</span>

<span class="n">BODY_POINTS</span> <span class="o">=</span> <span class="n">mp_holistic</span><span class="o">.</span><span class="n">PoseLandmark</span><span class="o">.</span><span class="n">_member_names_</span>
<span class="n">BODY_LIMBS</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">mp_holistic</span><span class="o">.</span><span class="n">POSE_CONNECTIONS</span><span class="p">]</span>

<span class="n">HAND_POINTS</span> <span class="o">=</span> <span class="n">mp_holistic</span><span class="o">.</span><span class="n">HandLandmark</span><span class="o">.</span><span class="n">_member_names_</span>
<span class="n">HAND_LIMBS</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">mp_holistic</span><span class="o">.</span><span class="n">HAND_CONNECTIONS</span><span class="p">]</span>

<span class="n">FACE_POINTS_NUM</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">additional_points</span><span class="o">=</span><span class="mi">0</span><span class="p">:</span> <span class="n">additional_points</span> <span class="o">+</span> <span class="mi">468</span>
<span class="n">FACE_POINTS_NUM</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Gets total number of face points and additional points.</span>

<span class="s2">Parameters</span>
<span class="s2">----------</span>
<span class="s2">additional_points : int, optional</span>
<span class="s2">    number of additional points to be added. The defaults is 0.</span>

<span class="s2">Returns</span>
<span class="s2">-------</span>
<span class="s2">int</span>
<span class="s2">    total number of face points.</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">FACE_POINTS</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">additional_points</span><span class="o">=</span><span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">FACE_POINTS_NUM</span><span class="p">(</span><span class="n">additional_points</span><span class="p">))]</span>
<span class="n">FACE_POINTS</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Makes a list of string representations of face points indexes up to total face points number</span>

<span class="s2">Parameters</span>
<span class="s2">----------</span>
<span class="s2">additional_points : int, optional</span>
<span class="s2">    number of additional points to be considered. Defaults to 0</span>

<span class="s2">Returns</span>
<span class="s2">-------</span>
<span class="s2">list[str]</span>
<span class="s2">    List of strings of face point indices.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">FACE_LIMBS</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">mp_holistic</span><span class="o">.</span><span class="n">FACEMESH_TESSELATION</span><span class="p">]</span>

<span class="n">FLIPPED_BODY_POINTS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NOSE&#39;</span><span class="p">,</span> <span class="s1">&#39;RIGHT_EYE_INNER&#39;</span><span class="p">,</span> <span class="s1">&#39;RIGHT_EYE&#39;</span><span class="p">,</span> <span class="s1">&#39;RIGHT_EYE_OUTER&#39;</span><span class="p">,</span> <span class="s1">&#39;LEFT_EYE_INNER&#39;</span><span class="p">,</span> <span class="s1">&#39;LEFT_EYE&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;LEFT_EYE_OUTER&#39;</span><span class="p">,</span> <span class="s1">&#39;RIGHT_EAR&#39;</span><span class="p">,</span> <span class="s1">&#39;LEFT_EAR&#39;</span><span class="p">,</span> <span class="s1">&#39;MOUTH_RIGHT&#39;</span><span class="p">,</span> <span class="s1">&#39;MOUTH_LEFT&#39;</span><span class="p">,</span> <span class="s1">&#39;RIGHT_SHOULDER&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;LEFT_SHOULDER&#39;</span><span class="p">,</span> <span class="s1">&#39;RIGHT_ELBOW&#39;</span><span class="p">,</span> <span class="s1">&#39;LEFT_ELBOW&#39;</span><span class="p">,</span> <span class="s1">&#39;RIGHT_WRIST&#39;</span><span class="p">,</span> <span class="s1">&#39;LEFT_WRIST&#39;</span><span class="p">,</span> <span class="s1">&#39;RIGHT_PINKY&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;LEFT_PINKY&#39;</span><span class="p">,</span> <span class="s1">&#39;RIGHT_INDEX&#39;</span><span class="p">,</span> <span class="s1">&#39;LEFT_INDEX&#39;</span><span class="p">,</span> <span class="s1">&#39;RIGHT_THUMB&#39;</span><span class="p">,</span> <span class="s1">&#39;LEFT_THUMB&#39;</span><span class="p">,</span> <span class="s1">&#39;RIGHT_HIP&#39;</span><span class="p">,</span> <span class="s1">&#39;LEFT_HIP&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;RIGHT_KNEE&#39;</span><span class="p">,</span> <span class="s1">&#39;LEFT_KNEE&#39;</span><span class="p">,</span> <span class="s1">&#39;RIGHT_ANKLE&#39;</span><span class="p">,</span> <span class="s1">&#39;LEFT_ANKLE&#39;</span><span class="p">,</span> <span class="s1">&#39;RIGHT_HEEL&#39;</span><span class="p">,</span> <span class="s1">&#39;LEFT_HEEL&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;RIGHT_FOOT_INDEX&#39;</span><span class="p">,</span> <span class="s1">&#39;LEFT_FOOT_INDEX&#39;</span><span class="p">,</span> <span class="p">]</span>


<div class="viewcode-block" id="component_points"><a class="viewcode-back" href="../../../pose_format.utils.holistic.html#pose_format.utils.holistic.component_points">[docs]</a><span class="k">def</span> <span class="nf">component_points</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets component points</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    component : object</span>
<span class="sd">        Component with landmarks</span>
<span class="sd">    width : int</span>
<span class="sd">        Width</span>
<span class="sd">    height : int</span>
<span class="sd">        Height</span>
<span class="sd">    num : int</span>
<span class="sd">        number of landmarks</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple of np.array</span>
<span class="sd">        coordinates and confidence for each landmark</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">component</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lm</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">landmark</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">height</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">lm</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num</span><span class="p">)</span></div>


<div class="viewcode-block" id="body_points"><a class="viewcode-back" href="../../../pose_format.utils.holistic.html#pose_format.utils.holistic.body_points">[docs]</a><span class="k">def</span> <span class="nf">body_points</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    gets body points</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    component : object</span>
<span class="sd">        component containing landmarks</span>
<span class="sd">    width : int</span>
<span class="sd">        width</span>
<span class="sd">    height : int</span>
<span class="sd">        Height</span>
<span class="sd">    num : int</span>
<span class="sd">        number of landmarks</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple of np.array</span>
<span class="sd">        coordinates and visibility for each landmark.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">component</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lm</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">landmark</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">height</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">lm</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">visibility</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">lm</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num</span><span class="p">)</span></div>


<div class="viewcode-block" id="process_holistic"><a class="viewcode-back" href="../../../pose_format.utils.holistic.html#pose_format.utils.holistic.process_holistic">[docs]</a><span class="k">def</span> <span class="nf">process_holistic</span><span class="p">(</span><span class="n">frames</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">kinect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">additional_face_points</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">additional_holistic_config</span><span class="o">=</span><span class="p">{})</span> <span class="o">-&gt;</span> <span class="n">NumPyPoseBody</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    process frames using holistic model from mediapipe</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frames : list</span>
<span class="sd">        List of frames to be processed</span>
<span class="sd">    fps : float</span>
<span class="sd">        Frames per second</span>
<span class="sd">    w : int</span>
<span class="sd">        Frame width</span>
<span class="sd">    h : int</span>
<span class="sd">        Frame height.</span>
<span class="sd">    kinect : object, optional</span>
<span class="sd">        Kinect depth data.</span>
<span class="sd">    progress : bool, optional</span>
<span class="sd">        If True, show the progress bar.</span>
<span class="sd">    additional_face_points : int, optional</span>
<span class="sd">        Additional face landmarks (points)</span>
<span class="sd">    additional_holistic_config : dict, optional</span>
<span class="sd">        Additional configurations for holistic model</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    NumPyPoseBody</span>
<span class="sd">        Processed pose data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">holistic</span> <span class="o">=</span> <span class="n">mp_holistic</span><span class="o">.</span><span class="n">Holistic</span><span class="p">(</span><span class="n">static_image_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">additional_holistic_config</span><span class="p">)</span>

    <span class="n">datas</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">confs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">progress</span><span class="p">)):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">holistic</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="n">body_data</span><span class="p">,</span> <span class="n">body_confidence</span> <span class="o">=</span> <span class="n">body_points</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">pose_landmarks</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>
        <span class="n">face_data</span><span class="p">,</span> <span class="n">face_confidence</span> <span class="o">=</span> <span class="n">component_points</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">face_landmarks</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span>
                                                      <span class="n">FACE_POINTS_NUM</span><span class="p">(</span><span class="n">additional_face_points</span><span class="p">))</span>
        <span class="n">lh_data</span><span class="p">,</span> <span class="n">lh_confidence</span> <span class="o">=</span> <span class="n">component_points</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">left_hand_landmarks</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
        <span class="n">rh_data</span><span class="p">,</span> <span class="n">rh_confidence</span> <span class="o">=</span> <span class="n">component_points</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">right_hand_landmarks</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
        <span class="n">body_world_data</span><span class="p">,</span> <span class="n">body_world_confidence</span> <span class="o">=</span> <span class="n">body_points</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">pose_world_landmarks</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">body_data</span><span class="p">,</span> <span class="n">face_data</span><span class="p">,</span> <span class="n">lh_data</span><span class="p">,</span> <span class="n">rh_data</span><span class="p">,</span> <span class="n">body_world_data</span><span class="p">])</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">body_confidence</span><span class="p">,</span> <span class="n">face_confidence</span><span class="p">,</span> <span class="n">lh_confidence</span><span class="p">,</span> <span class="n">rh_confidence</span><span class="p">,</span> <span class="n">body_world_confidence</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">kinect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kinect_depth</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">w</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">:</span>
                    <span class="n">kinect_depth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kinect</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kinect_depth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">kinect_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kinect_depth</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">data</span><span class="p">,</span> <span class="n">kinect_vec</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">datas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">confs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>

    <span class="n">pose_body_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">datas</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">pose_body_conf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">confs</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">holistic</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">NumPyPoseBody</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pose_body_data</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="n">pose_body_conf</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">)</span></div>


<div class="viewcode-block" id="holistic_hand_component"><a class="viewcode-back" href="../../../pose_format.utils.holistic.html#pose_format.utils.holistic.holistic_hand_component">[docs]</a><span class="k">def</span> <span class="nf">holistic_hand_component</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pf</span><span class="o">=</span><span class="s2">&quot;XYZC&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PoseHeaderComponent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates holistic hand component</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        Component name</span>
<span class="sd">    pf : str, optional</span>
<span class="sd">        Point format</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    PoseHeaderComponent</span>
<span class="sd">        Hand component</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">PoseHeaderComponent</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="n">HAND_POINTS</span><span class="p">,</span> <span class="n">limbs</span><span class="o">=</span><span class="n">HAND_LIMBS</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">hand_colors</span><span class="p">,</span> <span class="n">point_format</span><span class="o">=</span><span class="n">pf</span><span class="p">)</span></div>


<div class="viewcode-block" id="holistic_components"><a class="viewcode-back" href="../../../pose_format.utils.holistic.html#pose_format.utils.holistic.holistic_components">[docs]</a><span class="k">def</span> <span class="nf">holistic_components</span><span class="p">(</span><span class="n">pf</span><span class="o">=</span><span class="s2">&quot;XYZC&quot;</span><span class="p">,</span> <span class="n">additional_face_points</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates list of holistic components</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pf : str, optional</span>
<span class="sd">        Point format</span>
<span class="sd">    additional_face_points : int, optional</span>
<span class="sd">        Additional face points/landmarks</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list of PoseHeaderComponent</span>
<span class="sd">        List of holistic components.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">PoseHeaderComponent</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;POSE_LANDMARKS&quot;</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="n">BODY_POINTS</span><span class="p">,</span> <span class="n">limbs</span><span class="o">=</span><span class="n">BODY_LIMBS</span><span class="p">,</span>
                            <span class="n">colors</span><span class="o">=</span><span class="p">[(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">point_format</span><span class="o">=</span><span class="n">pf</span><span class="p">),</span>
        <span class="n">PoseHeaderComponent</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;FACE_LANDMARKS&quot;</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="n">FACE_POINTS</span><span class="p">(</span><span class="n">additional_face_points</span><span class="p">),</span> <span class="n">limbs</span><span class="o">=</span><span class="n">FACE_LIMBS</span><span class="p">,</span>
                            <span class="n">colors</span><span class="o">=</span><span class="p">[(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">point_format</span><span class="o">=</span><span class="n">pf</span><span class="p">),</span>
        <span class="n">holistic_hand_component</span><span class="p">(</span><span class="s2">&quot;LEFT_HAND_LANDMARKS&quot;</span><span class="p">,</span> <span class="n">pf</span><span class="p">),</span>
        <span class="n">holistic_hand_component</span><span class="p">(</span><span class="s2">&quot;RIGHT_HAND_LANDMARKS&quot;</span><span class="p">,</span> <span class="n">pf</span><span class="p">),</span>
        <span class="n">PoseHeaderComponent</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;POSE_WORLD_LANDMARKS&quot;</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="n">BODY_POINTS</span><span class="p">,</span> <span class="n">limbs</span><span class="o">=</span><span class="n">BODY_LIMBS</span><span class="p">,</span>
                            <span class="n">colors</span><span class="o">=</span><span class="p">[(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">point_format</span><span class="o">=</span><span class="n">pf</span><span class="p">),</span>
    <span class="p">]</span></div>


<div class="viewcode-block" id="load_holistic"><a class="viewcode-back" href="../../../pose_format.utils.holistic.html#pose_format.utils.holistic.load_holistic">[docs]</a><span class="k">def</span> <span class="nf">load_holistic</span><span class="p">(</span><span class="n">frames</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">24</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kinect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">additional_holistic_config</span><span class="o">=</span><span class="p">{})</span> <span class="o">-&gt;</span> <span class="n">Pose</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads holistic pose data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frames : list</span>
<span class="sd">        List of frames.</span>
<span class="sd">    fps : float, optional</span>
<span class="sd">        Frames per second.</span>
<span class="sd">    width : int, optional</span>
<span class="sd">        Frame width.</span>
<span class="sd">    height : int, optional</span>
<span class="sd">        Frame height.</span>
<span class="sd">    depth : int, optional</span>
<span class="sd">        Depth data.</span>
<span class="sd">    kinect : object, optional</span>
<span class="sd">        Kinect depth data.</span>
<span class="sd">    progress : bool, optional</span>
<span class="sd">        If True, show the progress bar.</span>
<span class="sd">    additional_holistic_config : dict, optional</span>
<span class="sd">        Additional configurations for the holistic model.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Pose</span>
<span class="sd">        Loaded pose data with header and body </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pf</span> <span class="o">=</span> <span class="s2">&quot;XYZC&quot;</span> <span class="k">if</span> <span class="n">kinect</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;XYZKC&quot;</span>

    <span class="n">dimensions</span> <span class="o">=</span> <span class="n">PoseHeaderDimensions</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>

    <span class="n">refine_face_landmarks</span> <span class="o">=</span> <span class="s1">&#39;refine_face_landmarks&#39;</span> <span class="ow">in</span> <span class="n">additional_holistic_config</span> <span class="ow">and</span> <span class="n">additional_holistic_config</span><span class="p">[</span>
        <span class="s1">&#39;refine_face_landmarks&#39;</span><span class="p">]</span>
    <span class="n">additional_face_points</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">refine_face_landmarks</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">header</span><span class="p">:</span> <span class="n">PoseHeader</span> <span class="o">=</span> <span class="n">PoseHeader</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="n">dimensions</span><span class="p">,</span>
                                    <span class="n">components</span><span class="o">=</span><span class="n">holistic_components</span><span class="p">(</span><span class="n">pf</span><span class="p">,</span> <span class="n">additional_face_points</span><span class="p">))</span>
    <span class="n">body</span><span class="p">:</span> <span class="n">NumPyPoseBody</span> <span class="o">=</span> <span class="n">process_holistic</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">kinect</span><span class="p">,</span> <span class="n">progress</span><span class="p">,</span> <span class="n">additional_face_points</span><span class="p">,</span>
                                           <span class="n">additional_holistic_config</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Pose</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span></div>


<div class="viewcode-block" id="formatted_holistic_pose"><a class="viewcode-back" href="../../../pose_format.utils.holistic.html#pose_format.utils.holistic.formatted_holistic_pose">[docs]</a><span class="k">def</span> <span class="nf">formatted_holistic_pose</span><span class="p">(</span><span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">additional_face_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Formatted holistic pose</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    width : int</span>
<span class="sd">        Pose width.</span>
<span class="sd">    height : int</span>
<span class="sd">        Pose height.</span>
<span class="sd">    additional_face_points : int, optional</span>
<span class="sd">        Additional face points/landmarks.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    object</span>
<span class="sd">        Formatted pose components</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dimensions</span> <span class="o">=</span> <span class="n">PoseHeaderDimensions</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">PoseHeader</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="n">dimensions</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="n">holistic_components</span><span class="p">(</span><span class="s2">&quot;XYZC&quot;</span><span class="p">,</span> <span class="n">additional_face_points</span><span class="p">))</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">NumPyPoseBody</span><span class="p">(</span><span class="n">fps</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="c1"># to be overridden later</span>
                         <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">header</span><span class="o">.</span><span class="n">total_points</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)),</span>
                         <span class="n">confidence</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">header</span><span class="o">.</span><span class="n">total_points</span><span class="p">())))</span>
    <span class="n">pose</span> <span class="o">=</span> <span class="n">Pose</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pose</span><span class="o">.</span><span class="n">get_components</span><span class="p">([</span><span class="s2">&quot;POSE_LANDMARKS&quot;</span><span class="p">,</span> <span class="s2">&quot;FACE_LANDMARKS&quot;</span><span class="p">,</span> <span class="s2">&quot;LEFT_HAND_LANDMARKS&quot;</span><span class="p">,</span> <span class="s2">&quot;RIGHT_HAND_LANDMARKS&quot;</span><span class="p">],</span>
                               <span class="p">{</span><span class="s2">&quot;FACE_LANDMARKS&quot;</span><span class="p">:</span> <span class="n">FACEMESH_CONTOURS_POINTS</span><span class="p">})</span></div>


<div class="viewcode-block" id="load_mediapipe_directory"><a class="viewcode-back" href="../../../pose_format.utils.holistic.html#pose_format.utils.holistic.load_mediapipe_directory">[docs]</a><span class="k">def</span> <span class="nf">load_mediapipe_directory</span><span class="p">(</span><span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_face_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pose</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load pose data from a directory of MediaPipe</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    directory : str</span>
<span class="sd">        Directory path.</span>
<span class="sd">    fps : float</span>
<span class="sd">        Frames per second.</span>
<span class="sd">    width : int</span>
<span class="sd">        Frame width.</span>
<span class="sd">    height : int</span>
<span class="sd">        Frame height.</span>
<span class="sd">    num_face_points : int, optional</span>
<span class="sd">        Number of face landmarks. Ideally, we don&#39;t want to hard code the 128 for the face, since face points can be 128 (reduced with refinement) or 118 (reduced without refinement) or 478 (full with refinement) or 468 (full without refinement)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Pose</span>
<span class="sd">        Loaded pose data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">frames</span> <span class="o">=</span> <span class="n">load_frames_directory_dict</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;(?:^|\D)?(\d+).*?.json&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">first_frame</span> <span class="o">=</span> <span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">num_pose_points</span> <span class="o">=</span> <span class="n">first_frame</span><span class="p">[</span><span class="s2">&quot;pose_landmarks&quot;</span><span class="p">][</span><span class="s2">&quot;num_landmarks&quot;</span><span class="p">]</span>
        <span class="n">num_left_hand_points</span> <span class="o">=</span> <span class="n">first_frame</span><span class="p">[</span><span class="s2">&quot;left_hand_landmarks&quot;</span><span class="p">][</span><span class="s2">&quot;num_landmarks&quot;</span><span class="p">]</span>
        <span class="n">num_right_hand_points</span> <span class="o">=</span> <span class="n">first_frame</span><span class="p">[</span><span class="s2">&quot;right_hand_landmarks&quot;</span><span class="p">][</span><span class="s2">&quot;num_landmarks&quot;</span><span class="p">]</span>
        <span class="n">additional_face_points</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="p">(</span><span class="n">num_face_points</span> <span class="o">==</span> <span class="mi">478</span> <span class="ow">or</span> <span class="n">num_face_points</span> <span class="o">==</span> <span class="mi">128</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No frames found in directory: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directory</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">load_mediapipe_frame</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get landmarks data of face landmarks, pose landmarks, and left &amp; right hand landmarks (body_data, face_data, lh_data, rh_data) and confidence values from a given frame.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frame : dict</span>
<span class="sd">        Dictionary containing face, pose, left hand, and right hand landmark data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple of numpy.ndarray</span>
<span class="sd">        A tuple containing two arrays:</span>
<span class="sd">        The first array is the landmarks data including x, y, z coordinates. </span>
<span class="sd">        The second array is the confidence scores for each landmark.</span>
<span class="sd">         &quot;&quot;&quot;</span>
        
        <span class="k">def</span> <span class="nf">load_landmarks</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">num_points</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;landmarks&quot;</span><span class="p">]]</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ps</span> <span class="o">+</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">])[:</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">ps</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>  <span class="c1"># Add visibility to all points</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">points</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_points</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">points</span><span class="p">])</span>
        <span class="n">face_data</span><span class="p">,</span> <span class="n">face_confidence</span> <span class="o">=</span> <span class="n">load_landmarks</span><span class="p">(</span><span class="s2">&quot;face_landmarks&quot;</span><span class="p">,</span> <span class="n">num_face_points</span><span class="p">)</span>
        <span class="n">body_data</span><span class="p">,</span> <span class="n">body_confidence</span> <span class="o">=</span> <span class="n">load_landmarks</span><span class="p">(</span><span class="s2">&quot;pose_landmarks&quot;</span><span class="p">,</span> <span class="n">num_pose_points</span><span class="p">)</span>
        <span class="n">lh_data</span><span class="p">,</span> <span class="n">lh_confidence</span> <span class="o">=</span> <span class="n">load_landmarks</span><span class="p">(</span><span class="s2">&quot;left_hand_landmarks&quot;</span><span class="p">,</span> <span class="n">num_left_hand_points</span><span class="p">)</span>
        <span class="n">rh_data</span><span class="p">,</span> <span class="n">rh_confidence</span> <span class="o">=</span> <span class="n">load_landmarks</span><span class="p">(</span><span class="s2">&quot;right_hand_landmarks&quot;</span><span class="p">,</span> <span class="n">num_right_hand_points</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">body_data</span><span class="p">,</span> <span class="n">face_data</span><span class="p">,</span> <span class="n">lh_data</span><span class="p">,</span> <span class="n">rh_data</span><span class="p">])</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">body_confidence</span><span class="p">,</span> <span class="n">face_confidence</span><span class="p">,</span> <span class="n">lh_confidence</span><span class="p">,</span> <span class="n">rh_confidence</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">conf</span>

    <span class="k">def</span> <span class="nf">load_mediapipe_frames</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">NumPyPoseBody</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;From a list of frames, load  pose data and confidance into a NumPyPoseBody</span>
<span class="sd">        </span>
<span class="sd">        Processes each frame from `frames` to extract the data and confidence values</span>
<span class="sd">        for pose landmarks, face landmarks, and left &amp; right hand landmarks.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        NumPyPoseBody</span>
<span class="sd">            PoseBody object with data and confidence for each frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">max_frames</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">frames</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">pose_body_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">max_frames</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_left_hand_points</span> <span class="o">+</span> <span class="n">num_right_hand_points</span> <span class="o">+</span> <span class="n">num_pose_points</span> <span class="o">+</span> <span class="n">num_face_points</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">pose_body_conf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">max_frames</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_left_hand_points</span> <span class="o">+</span> <span class="n">num_right_hand_points</span> <span class="o">+</span> <span class="n">num_pose_points</span> <span class="o">+</span> <span class="n">num_face_points</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">frame_id</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">conf</span> <span class="o">=</span> <span class="n">load_mediapipe_frame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
            <span class="n">pose_body_data</span><span class="p">[</span><span class="n">frame_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">pose_body_conf</span><span class="p">[</span><span class="n">frame_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">conf</span>
        <span class="k">return</span> <span class="n">NumPyPoseBody</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pose_body_data</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="n">pose_body_conf</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">)</span>

    <span class="n">pose</span> <span class="o">=</span> <span class="n">formatted_holistic_pose</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">additional_face_points</span><span class="o">=</span><span class="n">additional_face_points</span><span class="p">)</span>

    <span class="n">pose</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">load_mediapipe_frames</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">pose</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Moryossef, Amit and Mller, Mathias.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>